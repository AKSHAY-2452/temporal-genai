You are generating Python code for a Temporal Workflow System.

USER INSTRUCTION:
{user_instruction}

AVAILABLE MCP TOOLS:
{tools}

IMPORTANT — DO NOT BREAK THESE RULES:
1. All workflow inputs MUST be dataclasses.
2. Workflows MUST NOT accept primitive types (str, dict, int).
3. Activities MAY use primitives and dicts.
4. Workflows MUST use dataclass fields, NEVER dictionary keys.
5. All generated code MUST be syntactically correct, runnable, import-complete, and consistent.

When generating Python dataclasses for Temporal workflow inputs:

1. All fields EXCEPT the primary identifier must be OPTIONAL.
2. Use typing.Optional for all optional fields.
3. Default value for optional fields must be = None.
4. Example format:

from dataclasses import dataclass
from typing import Optional, List, Dict

@dataclass
class WorkflowInput:
    order_id: str                                  # required
    customer_email: Optional[str] = None           # optional
    items: Optional[List[Dict]] = None             # optional

OUTPUT FORMAT:
Generate code in this exact format:

### ACTIVITIES_START ###
[Put all activities.py code here]
### ACTIVITIES_END ###

### WORKFLOW_START ###
[Put all workflow.py code here]
### WORKFLOW_END ###

===============================================================
ACTIVITIES.PY REQUIREMENTS:
===============================================================
- Imports:
    from temporalio import activity
    from typing import Any, Dict, List, Optional
- One activity function per MCP tool used
- Decorate each activity with @activity.defn
- Activities MUST have type hints
- Include try/except for error handling
- Activities MAY accept dicts, primitives, lists
- Activities MUST NOT import workflow code

Example pattern:

@activity.defn
async def fetch_order_activity(order_id: str) -> Dict:
    try:
        return fetch_order_tool(order_id)
    except Exception as e:
        raise RuntimeError(f"Activity failed: {{e}}")

@activity.defn
async def send_email_activity(to: str, subject: str, body: str) -> Dict:
    try:
        return send_email_tool(to, subject, body)
    except Exception as e:
        raise RuntimeError(f"Activity failed: {{e}}")

===============================================================
WORKFLOW.PY REQUIREMENTS:
===============================================================
- Imports:
    from temporalio import workflow
    from datetime import timedelta
    from dataclasses import dataclass
    from typing import Dict, List, Optional
    from . import activities
- Define an input dataclass, e.g.:

@dataclass
class WorkflowInput:
    order_id: str
    customer_email: Optional[str] = None
    items: Optional[List[Dict]] = None

- Create a workflow class with @workflow.defn
- Define @workflow.run(self, input: WorkflowInput)
- Use workflow.execute_activity() to run activities
- MUST specify start_to_close_timeout=timedelta(minutes=5)
- Return final result as a dataclass or dict
- MUST wrap the workflow body in try/except

Example pattern:

@workflow.defn
class OrderProcessingWorkflow:
    @workflow.run
    async def run(self, input: WorkflowInput) -> Dict:
        try:
            result = await workflow.execute_activity(
                activities.fetch_order_activity,
                input.order_id,
                start_to_close_timeout=timedelta(minutes=5),
            )
            return {{"status": "ok", "data": result}}
        except Exception as e:
            raise workflow.ApplicationError(str(e))

===============================================================
STYLE GUIDELINES:
===============================================================
- Use snake_case for all variables and parameters.
- Use dataclasses ONLY for workflow inputs and outputs.
- Never assume missing imports — include everything required.
- Never reference undefined functions.
- Never generate conflicting types across workflow and activities.
- All code must be valid as-is, without modification.

The output MUST follow the exact markers:

### ACTIVITIES_START ###
... activities code ...
### ACTIVITIES_END ###

### WORKFLOW_START ###
... workflow code ...
### WORKFLOW_END ###
